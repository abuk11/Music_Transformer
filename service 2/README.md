Проект: Генерация музыки с использованием Transformer  

**Актуальность:** современные инструменты ИИ всё активнее входят в индустрию развлечений и музыки, позволяя создавать новые произведения без глубоких музыкальных знаний. Также ИИ проникает и в профессиональное искусство, например, битмейкеры, которые зачастую используют FL Studio (программа для создания треков), в котором поддерживается множество плагинов, в том числе использующих нейросети, которые заметно упрощают процесс создания музыки.

**Цель проекта:** разработать систему генерации музыкальных произведений различных жанров. В частности, выбраны 4 жанра — `pop`, `jazz`, `edm`, `classical`. Проект включает сбор и подготовку данных, обучение модели, реализацию метрик качества и разработку веб‑интерфейса для генерации и воспроизведения музыки.

## Обучение

- Используются MIDI-представления треков.
- Датасеты загружены и размечены по жанровым папкам.
- Настроен токенизатор REMI (из `miditok`):
  - диапазон нот;
  - специальные токены: `PAD`, `BOS`, `EOS`;
  - жанровые токены.
- К каждой последовательности добавляется токен жанра в начало.
- Все треки разбиты на перекрывающиеся блоки фиксированной длины.
- Модель: `GPT2LMHeadModel` с параметрами:
  - `n_embd=512`, `n_layer=6`, `n_head=8`, `n_positions=512`.
- Потери: `CrossEntropyLoss`, оптимизатор: `AdamW`, warm-up scheduler.
- Использовался небольшой batch size (4–16), как рекомендовано для музыки.

## Инференс

- Полученные токены преобразуются обратно в MIDI.
- MIDI-файл рендерится в WAV двумя способами:
  - `midi_to_wav_puresynth`: синусоидальный генератор;
  - `midi_to_wav_soundfont`: через FluidSynth.

## Оценка качества

- Следился лосс и норма весов модели — для контроля переобучения.
- Использовались сохранения чекпоинтов после каждой эпохи.
- Основная метрика — субъективное восприятие результата.

Требования
- Python 3.11
- CUDA 11.7+

Инициализируйте проект с помощью `uv`:

```uv init .```

`uv venv .venv --python 3.11`

`uv sync --all-extras --frozen`

Имеются следующие зависимости:

```
[project]
name = "music-genre-transformer"
version = "0.1.0"
description = "Music generation"
authors = ["Your Name <email@example.com>"]
dependencies = [
    "torch",
    "transformers",
    "miditok",
    "pretty-midi",
    "soundfile",
    "midi2audio",
    "Flask",
    "scipy",
    "wandb"
]
```

`uv lock`

Активируйте окружение:
`source .venv/bin/activate.fish`

## Пример команды обучения (необходимо гпу с CUDA 11.7+, могут возникнуть проблемы с miditok)

```bash
ur run python src/train.py \
  --data_dir data/ \
  --output_dir checkpoints/ \
  --epochs 10 \
  --batch_size 4
```

## Запуск сервиса:

`uv run python server.py`